<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Quantifying the geological completeness of paleontological sampling in North America • rmacrostrat</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Quantifying the geological completeness of paleontological sampling in North America">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rmacrostrat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/geologic-map.html">Making a geologic outcrop map with rmacrostrat</a></li>
    <li><a class="dropdown-item" href="../articles/geological-completeness.html">Quantifying the geological completeness of paleontological sampling in North America</a></li>
    <li><a class="dropdown-item" href="../articles/stratigraphic-column.html">Plotting a stratigraphic column with rmacrostrat</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/palaeoverse/rmacrostrat/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Quantifying the geological completeness of paleontological sampling in North America</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/palaeoverse/rmacrostrat/blob/main/vignettes/geological-completeness.Rmd" class="external-link"><code>vignettes/geological-completeness.Rmd</code></a></small>
      <div class="d-none name"><code>geological-completeness.Rmd</code></div>
    </div>

    
    
<p><strong>Authors:</strong> <a href="https://palaeoverse.org/#about-us" class="external-link">Palaeoverse Development
Team</a></p>
<p><strong>Last updated:</strong> 2024-10-04</p>
<div style="text-align: justify">
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>rmacrostrat</code> is an R package which allows users to easily
retrieve geological data from the <a href="https://macrostrat.org" class="external-link">Macrostrat</a> database and facilitates
analyses of these data within the R environment. This vignette (or
tutorial, if you prefer) is provided to guide you through the
installation process and some of the functionality available within
<code>rmacrostrat</code>. Specifically, we will focus on reproducing a
classical figure (i.e., Fig. 14) from <a href="https://www.jstor.org/stable/25609444" class="external-link">Peters &amp; Heim
(2010)</a>, which visualizes the changing number–and proportion–of
sedimentary lithostratigraphic units from different paleoenvironments
throughout the Phanerozoic. Let’s get started!</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The <code>rmacrostrat</code> package can be installed via CRAN, or
its dedicated <a href="https://github.com/palaeoverse/rmacrostrat" class="external-link">GitHub repository</a>
if the development version is preferred. To install via CRAN, simply
use:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"rmacrostrat"</span><span class="op">)</span></span></code></pre></div>
<p>To install the development version, first install the
<code>devtools</code> package, and then use <code>install_github</code>
to install <code>rmacrostrat</code> directly from GitHub.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"palaeoverse/rmacrostrat"</span><span class="op">)</span></span></code></pre></div>
<p>You can now load <code>rmacrostrat</code> using the standard
<code>library</code> function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rmacrostrat.palaeoverse.org">rmacrostrat</a></span><span class="op">)</span></span></code></pre></div>
<p><strong>Before we get into the good stuff, the development team has a
small request</strong>. If you use <code>rmacrostrat</code> in your
research, please cite the associated publication. This will help us to
continue our work in supporting you to do yours. You can access the
appropriate citation via:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span><span class="st">"rmacrostrat"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## To cite rmacrostrat in publications, use the following citation:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Jones, L.A., Dean, C.D., Gearty, W., and Allen, B.J. 2024. rmacrostrat: An R package for accessing</span></span>
<span><span class="co">##   and retrieving data from the Macrostrat geological database. Geosphere, v. 20, doi:</span></span>
<span><span class="co">##   10.1130/GES02815.1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## A BibTeX entry for LaTeX users is</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   @Article{,</span></span>
<span><span class="co">##     title = {rmacrostrat: An R Package for fetching geologic data from the Macrostrat database.},</span></span>
<span><span class="co">##     author = {Lewis A. Jones and Christopher D. Dean and William Gearty and Bethany J. Allen},</span></span>
<span><span class="co">##     year = {2024},</span></span>
<span><span class="co">##     journal = {Geosphere},</span></span>
<span><span class="co">##     volume = {20},</span></span>
<span><span class="co">##     doi = {10.1130/GES02815.1},</span></span>
<span><span class="co">##   }</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="context">Context<a class="anchor" aria-label="anchor" href="#context"></a>
</h2>
<p>Quantifying the spatiotemporal distribution of sedimentary
lithostratigraphic units is fundamental to understanding how
environments, and the biodiversity within them, have evolved throughout
Earth’s history. Previous work by <a href="https://www.jstor.org/stable/25609444" class="external-link">Peters &amp; Heim
(2010)</a> focused on <em>“the geological completeness of
paleontological sampling in North America”</em>, with the aim of
recognizing and overcoming geologically-controlled sampling biases. One
component of this article involved quantifying how the number and
proportion of lithostratigraphic units preserving different
paleoenvironment types (e.g., marine, marginal, terrestrial) varies
through time. In this vignette, we will revisit this question and
examine how the number and proportion of different sedimentary
lithostratigraphic units–grouped by paleoenvironment type–changes over
the Phanerozoic. To do so, we will make use of the
<code>rmacrostrat</code> package to fetch data from the <a href="https://macrostrat.org" class="external-link">Macrostrat</a> database.</p>
</div>
<div class="section level2">
<h2 id="retrieving-data">Retrieving data<a class="anchor" aria-label="anchor" href="#retrieving-data"></a>
</h2>
<p>To quantify how the number and proportion of different
lithostratigraphic units change through time, we will focus on the
following paleoenvironmental groupings: marine, marginal, and
terrestrial. The first step in establishing these groupings is to see
what different environments are actually available in <a href="https://macrostrat.org" class="external-link">Macrostrat</a>:</p>
<p><em>Hint: Remember that all definitions of data stored in <a href="https://macrostrat.org" class="external-link">Macrostrat</a> are available via the
<code>def_</code> suite of functions.</em></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># What environments are available?</span></span>
<span><span class="co"># Hint: Defining no arguments returns all environments</span></span>
<span><span class="va">environments</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/def_environments.html">def_environments</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># See the first few rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">environments</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   environ_id                                 name      type  class   color t_units</span></span>
<span><span class="co">## 1          1                            peritidal carbonate marine #B8B8E6      94</span></span>
<span><span class="co">## 2          2                     shallow subtidal carbonate marine #3399FF     815</span></span>
<span><span class="co">## 3          3                open shallow subtidal carbonate marine #3399FF     421</span></span>
<span><span class="co">## 4          4 lagoonal/restricted shallow subtidal carbonate marine #B8B8E6     216</span></span>
<span><span class="co">## 5          5                           sand shoal carbonate marine #5CADFF      25</span></span>
<span><span class="co">## 6          6                                 reef carbonate marine #33CCFF     156</span></span></code></pre>
<p>From this call, we can see a whole suite of different inferred
paleoenvironments are available, which are conveniently grouped into a
type (e.g., carbonate, fluvial, lacustrine) and class (i.e., marine and
non-marine). Class seems helpful for discerning between marine and
non-marine environments, but we also want a marginal category, so we
need to re-classify some of these environment definitions.</p>
<p>We can define which paleoenvironments are marginal using the
additional information available in the <code>name</code> column of
<code>environments</code>. For this definition, let’s consider that any
environment that is classified as a delta, beach, barrier island,
estuary, lagoon, or tidal flat is a marginal environment. From our
available environments (<em>n</em> = 87), we can identify 22 as marginal
environments. This classification is perhaps a little subjective, but
for this vignette it provides a fair representation of marginal
environments:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define an object classifying marginal paleoenvironments</span></span>
<span><span class="va">marginal_envs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shallow subtidal"</span>, <span class="st">"open shallow subtidal"</span>,</span>
<span>                   <span class="st">"lagoonal/restricted shallow subtidal"</span>, <span class="st">"paralic indet."</span>,</span>
<span>                   <span class="st">"lagoonal"</span>, <span class="st">"coastal indet."</span>, <span class="st">"foreshore"</span>, <span class="st">"shoreface"</span>,</span>
<span>                   <span class="st">"transition zone/lower shoreface"</span>, <span class="st">"barrier bar"</span>,</span>
<span>                   <span class="st">"deltaic indet."</span>, <span class="st">"delta plain"</span>, <span class="st">"interdistributary bay"</span>,</span>
<span>                   <span class="st">"delta front"</span>, <span class="st">"prodelta"</span>, <span class="st">"marginal marine"</span>,</span>
<span>                   <span class="st">"deltaic indet."</span>, <span class="st">"delta plain"</span>, <span class="st">"lacustrine deltaic indet."</span>,</span>
<span>                   <span class="st">"lacustrine delta plain"</span>, <span class="st">"lacustrine prodelta"</span>, <span class="st">"playa"</span><span class="op">)</span></span></code></pre></div>
<p>Now that we’ve defined our marginal paleoenvironments, we can
re-classify the <code>class</code> column in <code>environments</code>
so that we have three categories. We can also replace the label
“non-marine” with “terrestrial” for clarity:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Update class to include marginal</span></span>
<span><span class="va">environments</span><span class="op">$</span><span class="va">class</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">environments</span><span class="op">$</span><span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">marginal_envs</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"marginal"</span></span>
<span><span class="co"># Change the name of non-marine class to terrestrial</span></span>
<span><span class="va">environments</span><span class="op">$</span><span class="va">class</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">environments</span><span class="op">$</span><span class="va">class</span> <span class="op">==</span> <span class="st">"non-marine"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"terrestrial"</span></span></code></pre></div>
<p>For simplicity, we will create three separate
<code>data.frame</code>s, one for each paleoenvironment.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Subset dataframe</span></span>
<span><span class="va">marine</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">environments</span>, <span class="va">class</span> <span class="op">==</span> <span class="st">"marine"</span><span class="op">)</span></span>
<span><span class="va">marginal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">environments</span>, <span class="va">class</span> <span class="op">==</span> <span class="st">"marginal"</span><span class="op">)</span></span>
<span><span class="va">terrestrial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">environments</span>, <span class="va">class</span> <span class="op">==</span> <span class="st">"terrestrial"</span><span class="op">)</span></span></code></pre></div>
<p>Great! So we now have our groupings, but if we want to investigate
how lithostratigraphic units change through time, we need a little more
information. Specifically, we need to know the inferred paleoenvironment
and age of each lithostratigraphic unit. We can retrieve such
information about lithostratigraphic units using the
<code>get_units</code> function. Conveniently, we can request such data
for each paleoenvironmental class using the <code>environ_id</code>
column.</p>
<p><em>Hint: Remember that to retrieve data stored in <a href="https://macrostrat.org" class="external-link">Macrostrat</a> (e.g., Macrostrat columns,
sections, and units), the <code>get_</code> suite of functions must be
used.</em></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Retrieve marine units</span></span>
<span><span class="va">marine_units</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_units.html">get_units</a></span><span class="op">(</span>environ_id <span class="op">=</span> <span class="va">marine</span><span class="op">$</span><span class="va">environ_id</span><span class="op">)</span></span>
<span><span class="co"># Retrieve marginal units</span></span>
<span><span class="va">marginal_units</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_units.html">get_units</a></span><span class="op">(</span>environ_id <span class="op">=</span> <span class="va">marginal</span><span class="op">$</span><span class="va">environ_id</span><span class="op">)</span></span>
<span><span class="co"># Retrieve terrestrial units</span></span>
<span><span class="va">terrestrial_units</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_units.html">get_units</a></span><span class="op">(</span>environ_id <span class="op">=</span> <span class="va">terrestrial</span><span class="op">$</span><span class="va">environ_id</span><span class="op">)</span></span>
<span><span class="co"># Let's also add the environment class in these dataframes for consistency</span></span>
<span><span class="va">marine_units</span><span class="op">$</span><span class="va">environ_class</span> <span class="op">&lt;-</span> <span class="st">"Marine"</span></span>
<span><span class="va">marginal_units</span><span class="op">$</span><span class="va">environ_class</span> <span class="op">&lt;-</span> <span class="st">"Marginal"</span></span>
<span><span class="va">terrestrial_units</span><span class="op">$</span><span class="va">environ_class</span> <span class="op">&lt;-</span> <span class="st">"Terrestrial"</span></span></code></pre></div>
<p>Nice! That was pretty straightforward. However, some
<code>unit_id</code> values in the <code>marine</code> dataframe are
also present in the marginal and terrestrial dataframes, and vice
versa:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How many marine unit IDs are also in terrestrial?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">marine_units</span><span class="op">$</span><span class="va">unit_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">terrestrial_units</span><span class="op">$</span><span class="va">unit_id</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 499</span></span></code></pre>
<p>On further investigation, we can see that some lithostratigraphic
units are associated with multiple different paleoenvironments (various
combinations of marine, marginal, and terrestrial). Interesting, but
perhaps to be expected given transgression and regression cycles! We
should treat these differently to our pre-existing groupings for
clarity. Let’s make a new paleoenvironment class called “mixed”, and
update the environment class accordingly.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Which unit IDs are shared between several paleoenvironments?</span></span>
<span><span class="va">shared_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="co"># Marine</span></span>
<span>  <span class="va">marine_units</span><span class="op">$</span><span class="va">unit_id</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">marine_units</span><span class="op">$</span><span class="va">unit_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">terrestrial_units</span><span class="op">$</span><span class="va">unit_id</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="va">marine_units</span><span class="op">$</span><span class="va">unit_id</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">marine_units</span><span class="op">$</span><span class="va">unit_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">marginal_units</span><span class="op">$</span><span class="va">unit_id</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="co"># Marginal</span></span>
<span>  <span class="va">marginal_units</span><span class="op">$</span><span class="va">unit_id</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">marginal_units</span><span class="op">$</span><span class="va">unit_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">marine_units</span><span class="op">$</span><span class="va">unit_id</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="va">marginal_units</span><span class="op">$</span><span class="va">unit_id</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">marginal_units</span><span class="op">$</span><span class="va">unit_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">terrestrial_units</span><span class="op">$</span><span class="va">unit_id</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="co"># Terrestrial</span></span>
<span>  <span class="va">terrestrial_units</span><span class="op">$</span><span class="va">unit_id</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">terrestrial_units</span><span class="op">$</span><span class="va">unit_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">marine_units</span><span class="op">$</span><span class="va">unit_id</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="va">terrestrial_units</span><span class="op">$</span><span class="va">unit_id</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">terrestrial_units</span><span class="op">$</span><span class="va">unit_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">marginal_units</span><span class="op">$</span><span class="va">unit_id</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Get unique IDs</span></span>
<span><span class="va">shared_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">shared_id</span><span class="op">)</span></span>
<span><span class="co"># Combine dataframes</span></span>
<span><span class="va">litho_units</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind.data.frame</a></span><span class="op">(</span><span class="va">marine_units</span>, <span class="va">marginal_units</span>, <span class="va">terrestrial_units</span><span class="op">)</span></span>
<span><span class="co"># Recode environment class</span></span>
<span><span class="va">litho_units</span><span class="op">$</span><span class="va">environ_class</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">litho_units</span><span class="op">$</span><span class="va">unit_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">shared_id</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Mixed"</span></span>
<span><span class="co"># Retain only unique units</span></span>
<span><span class="va">litho_units</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">litho_units</span><span class="op">)</span></span></code></pre></div>
<p>Great, we can now see that we don’t have any duplicate units in our
dataset anymore:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check if any units appear more than once</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">litho_units</span><span class="op">$</span><span class="va">unit_id</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] FALSE</span></span></code></pre>
<p>OK - we now have four lithostratigraphic groupings for our units, but
Figure 14 from <a href="https://www.jstor.org/stable/25609444" class="external-link">Peters
&amp; Heim (2010)</a> includes a fifth unit group, “unknown”. For the
sake of completeness, let’s get all sedimentary lithostratigraphic units
not already covered by our other four groupings (marine, marginal,
mixed, and terrestrial). As we cannot search <a href="https://macrostrat.org" class="external-link">Macrostrat</a> by “unknown”, we will first
pull all Phanerozoic sedimentary units, and then filter out units
already present in our <code>litho_units</code> dataset.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get all sedimentary Phanerozoic units</span></span>
<span><span class="va">all_units</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_units.html">get_units</a></span><span class="op">(</span>interval_name <span class="op">=</span> <span class="st">"Phanerozoic"</span>, lithology_class <span class="op">=</span> <span class="st">"sedimentary"</span><span class="op">)</span></span>
<span><span class="co"># Remove units not already present in litho_units (unknown palaeoenvironments)</span></span>
<span><span class="va">unknown_units</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">all_units</span>, <span class="op">!</span><span class="va">unit_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">litho_units</span><span class="op">$</span><span class="va">unit_id</span><span class="op">)</span></span>
<span><span class="co"># Check data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">unknown_units</span><span class="op">$</span><span class="va">environ</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## list()</span></span></code></pre>
<p>Wow, updates to Macrostrat have led to no sedimentary units having an
“unknown” paleoenvironment - great! But we’ve just remembered that <a href="https://macrostrat.org" class="external-link">Macrostrat</a> doesn’t only cover North
America, and we’ve pulled all units available worldwide. To make a
closer reproduction of Figure 14 from <a href="https://www.jstor.org/stable/25609444" class="external-link">Peters &amp; Heim
(2010)</a>, we ought to just focus on North America. Conveniently, <a href="https://macrostrat.org" class="external-link">Macrostrat</a> is split into different
projects, which tend to cover different regions:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check available projects</span></span>
<span><span class="fu"><a href="../reference/def_projects.html">def_projects</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##    project_id                   project</span></span>
<span><span class="co">## 1           1             North America</span></span>
<span><span class="co">## 2           3                      eODP</span></span>
<span><span class="co">## 3           4                  Deep Sea</span></span>
<span><span class="co">## 4           5               New Zealand</span></span>
<span><span class="co">## 5           6                 Australia</span></span>
<span><span class="co">## 6           7                 Caribbean</span></span>
<span><span class="co">## 7           8             South America</span></span>
<span><span class="co">## 8           9                    Africa</span></span>
<span><span class="co">## 9          10  North American Ediacaran</span></span>
<span><span class="co">## 10         11 North American Cretaceous</span></span>
<span><span class="co">## 11         12                 Indonesia</span></span>
<span><span class="co">## 12         13          Northern Eurasia</span></span></code></pre>
<p>From this call, we can see that North America has a
<code>project_id</code> of 1. We can use this information to further
filter <code>litho_units</code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter to N. America</span></span>
<span><span class="va">litho_units</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">litho_units</span>, <span class="va">project_id</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Now we’ve got our data and done a bit of wrangling, let’s get on with
summarizing and visualizing it.</p>
</div>
<div class="section level2">
<h2 id="summarizing-data">Summarizing data<a class="anchor" aria-label="anchor" href="#summarizing-data"></a>
</h2>
<p>We are interested in how the number and proportion of
lithostratigraphic units representing different paleoenvironment classes
changes through time. Conveniently, lithostratigraphic units in <a href="https://macrostrat.org" class="external-link">Macrostrat</a> have age information
associated with them, specifically the minimum (<code>t_age</code>) and
maximum (<code>b_age</code>) age in millions of years before present.
Using this data, with some handy support functions from the
<code>palaeoverse</code> R package, we can count the number of
lithographic units within each paleoenvironmental group, and within each
time bin. We will use international stratigraphic stage bins as our time
bins for this:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load palaeoverse R package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://palaeoverse.palaeoverse.org" class="external-link">palaeoverse</a></span><span class="op">)</span></span>
<span><span class="co"># Generate stage-level time bins</span></span>
<span><span class="va">bins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://palaeoverse.palaeoverse.org/reference/time_bins.html" class="external-link">time_bins</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="st">"international ages"</span><span class="op">)</span></span>
<span><span class="co"># Rename age columns in litho_units to be consistent with bins</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">litho_units</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">litho_units</span><span class="op">)</span> <span class="op">==</span> <span class="st">"b_age"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"max_ma"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">litho_units</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">litho_units</span><span class="op">)</span> <span class="op">==</span> <span class="st">"t_age"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"min_ma"</span></span>
<span><span class="co"># As we are only interested in the Phanerozoic, let's remove any</span></span>
<span><span class="co"># units that have a minimum age of more than 538.8 Ma</span></span>
<span><span class="va">litho_units</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">litho_units</span>, <span class="va">min_ma</span> <span class="op">&lt;=</span> <span class="fl">538.8</span><span class="op">)</span></span>
<span><span class="co"># In case the maximum age of units exceeds 538.8, but the minimum</span></span>
<span><span class="co"># age is less than 538.8, let's set max_ma to 538.8 to still count it</span></span>
<span><span class="co"># if it appears at any point in the Fortunian</span></span>
<span><span class="va">litho_units</span><span class="op">$</span><span class="va">max_ma</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">litho_units</span><span class="op">$</span><span class="va">max_ma</span> <span class="op">&gt;</span> <span class="fl">538.8</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">538.8</span></span>
<span><span class="co"># Bin data using the bin_time function with the "all"</span></span>
<span><span class="co"># method. This will place units into all bins the unit</span></span>
<span><span class="co"># overlaps with, generating additional rows for each time</span></span>
<span><span class="co"># bin covered (expect an increase in the number of rows)</span></span>
<span><span class="va">litho_units</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://palaeoverse.palaeoverse.org/reference/bin_time.html" class="external-link">bin_time</a></span><span class="op">(</span>occdf <span class="op">=</span> <span class="va">litho_units</span>,</span>
<span>                        bins <span class="op">=</span> <span class="va">bins</span>,</span>
<span>                        min_ma <span class="op">=</span> <span class="st">"min_ma"</span>,</span>
<span>                        max_ma <span class="op">=</span> <span class="st">"max_ma"</span>,</span>
<span>                        method <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span>
<span><span class="co"># Calculate the number of environment classes per time bin</span></span>
<span><span class="co"># Remember, each row is a unique instance of a unit within a bin</span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://palaeoverse.palaeoverse.org/reference/group_apply.html" class="external-link">group_apply</a></span><span class="op">(</span>occdf <span class="op">=</span> <span class="va">litho_units</span>,</span>
<span>                      group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"environ_class"</span>, <span class="st">"bin_assignment"</span><span class="op">)</span>,</span>
<span>                      fun <span class="op">=</span> <span class="va">nrow</span><span class="op">)</span></span>
<span><span class="co"># Rename columns to ease reading and merging</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"count"</span>, <span class="st">"environment"</span>, <span class="st">"bin"</span><span class="op">)</span></span>
<span><span class="co"># Merge datasets to combine time bin information with counts</span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bins</span>, y <span class="op">=</span> <span class="va">counts</span>, by <span class="op">=</span> <span class="st">"bin"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualizing-data">Visualizing data<a class="anchor" aria-label="anchor" href="#visualizing-data"></a>
</h2>
<p>Now we have our summary of the lithostratigraphic units, we can
visualize this data. First, we will plot the number of units within each
paleoenvironment group through time. To support this data visualization,
we will make use of the <code>ggplot2</code> (plotting) and
<code>deeptime</code> (adding a geological timescale axis) R
packages.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load data visualization packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://williamgearty.com/deeptime/" class="external-link">deeptime</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's first set our factor levels to replicate the original figure</span></span>
<span><span class="va">counts</span><span class="op">$</span><span class="va">environment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">counts</span><span class="op">$</span><span class="va">environment</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Marine"</span>, <span class="st">"Marginal"</span>,</span>
<span>                                                            <span class="st">"Mixed"</span>, <span class="st">"Terrestrial"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate a plot of raw counts of lithostratigraphic units through time</span></span>
<span><span class="co"># grouped by paleoenvironment</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">counts</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">environment</span>, y <span class="op">=</span> <span class="va">count</span>, x <span class="op">=</span> <span class="va">mid_ma</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Stacked bar chart with bar width specified by interval duration</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"stack"</span>, stat <span class="op">=</span> <span class="st">"identity"</span>, width <span class="op">=</span> <span class="va">counts</span><span class="op">$</span><span class="va">duration_myr</span>,</span>
<span>           color <span class="op">=</span> <span class="st">"black"</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Label y-axis</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span><span class="st">"Number of lithostratigraphic units"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Label x-axis and reverse direction</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_reverse</a></span><span class="op">(</span><span class="st">"Time (Ma)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Data plotting colors</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Theming</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Add geological timescale</span></span>
<span>  <span class="fu"><a href="https://williamgearty.com/deeptime/reference/coord_geo.html" class="external-link">coord_geo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="visualize_counts-1.png" alt="plot of chunk visualize_counts" width="100%"><p class="caption">
plot of chunk visualize_counts
</p>
</div>
<p>We can also plot the proportion of units within each paleoenvironment
group through time.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate a plot of lithostratigraphic units through time grouped by</span></span>
<span><span class="co"># paleoenvironment as proportions</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">counts</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">environment</span>, y <span class="op">=</span> <span class="va">count</span>, x <span class="op">=</span> <span class="va">mid_ma</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Proportional bar chart with bar width specified by interval duration</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"fill"</span>, stat <span class="op">=</span> <span class="st">"identity"</span>, width <span class="op">=</span> <span class="va">counts</span><span class="op">$</span><span class="va">duration_myr</span>,</span>
<span>           color <span class="op">=</span> <span class="st">"black"</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Label y-axis</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span><span class="st">"Proportion of lithostratigraphic units"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Label x-axis and reverse direction</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_reverse</a></span><span class="op">(</span><span class="st">"Time (Ma)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Data plotting colors</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Theming</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Add geological timescale</span></span>
<span>  <span class="fu"><a href="https://williamgearty.com/deeptime/reference/coord_geo.html" class="external-link">coord_geo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="visualize_proportions-1.png" alt="plot of chunk visualize_proportions" width="100%"><p class="caption">
plot of chunk visualize_proportions
</p>
</div>
<p>And that’s it! Not too bad, right? There are some clear differences
between our generated plots and those from the original <a href="https://www.jstor.org/stable/25609444" class="external-link">Peters &amp; Heim
(2010)</a> paper (Fig. 14), which is to be expected given that
substantially more data is now available in <a href="https://macrostrat.org" class="external-link">Macrostrat</a> (e.g., no “unknown”
paleoenvironments), and there may be differences in what we defined as
“marginal” environments. Despite these differences, some broad-scale
patterns are largely consistent, such as the higher proportion of
terrestrial lithostratigraphic units in the Mesozoic and Cenozoic,
compared to the Paleozoic.</p>
</div>
<div class="section level2">
<h2 id="bonus-plot-rock-classes">Bonus plot: rock classes<a class="anchor" aria-label="anchor" href="#bonus-plot-rock-classes"></a>
</h2>
<p>We can use very similar code to explore many different geological
questions. For example, what if we were interested in the temporal
distribution of igneous and metamorphic rocks, as well as sedimentary?
Below we extract and plot data showing exactly this.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get units by lithology class, interval, and project ID</span></span>
<span><span class="va">sedimentary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_units.html">get_units</a></span><span class="op">(</span>lithology_class <span class="op">=</span> <span class="st">"sedimentary"</span>,</span>
<span>                         interval_name <span class="op">=</span> <span class="st">"Phanerozoic"</span>,</span>
<span>                         project_id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">igneous</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_units.html">get_units</a></span><span class="op">(</span>lithology_class <span class="op">=</span> <span class="st">"igneous"</span>,</span>
<span>                     interval_name <span class="op">=</span> <span class="st">"Phanerozoic"</span>,</span>
<span>                     project_id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">metamorphic</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_units.html">get_units</a></span><span class="op">(</span>lithology_class <span class="op">=</span> <span class="st">"metamorphic"</span>,</span>
<span>                        interval_name <span class="op">=</span> <span class="st">"Phanerozoic"</span>,</span>
<span>                        project_id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># Add column of sediment type</span></span>
<span><span class="va">sedimentary</span><span class="op">$</span><span class="va">lithology_class</span> <span class="op">&lt;-</span> <span class="st">"Sedimentary"</span></span>
<span><span class="va">igneous</span><span class="op">$</span><span class="va">lithology_class</span> <span class="op">&lt;-</span> <span class="st">"Igneous"</span></span>
<span><span class="va">metamorphic</span><span class="op">$</span><span class="va">lithology_class</span> <span class="op">&lt;-</span> <span class="st">"Metamorphic"</span></span>
<span><span class="co"># Bind data</span></span>
<span><span class="va">units</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind.data.frame</a></span><span class="op">(</span><span class="va">sedimentary</span>, <span class="va">igneous</span>, <span class="va">metamorphic</span><span class="op">)</span></span>
<span><span class="co"># Load palaeoverse library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://palaeoverse.palaeoverse.org" class="external-link">palaeoverse</a></span><span class="op">)</span></span>
<span><span class="co"># Generate stage-level time bins</span></span>
<span><span class="va">bins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://palaeoverse.palaeoverse.org/reference/time_bins.html" class="external-link">time_bins</a></span><span class="op">(</span>interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Phanerozoic"</span><span class="op">)</span>, scale <span class="op">=</span> <span class="st">"GTS2020"</span><span class="op">)</span></span>
<span><span class="co"># Rename age columns in units to be consistent with our bins</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">units</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">units</span><span class="op">)</span> <span class="op">==</span> <span class="st">"b_age"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"max_ma"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">units</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">units</span><span class="op">)</span> <span class="op">==</span> <span class="st">"t_age"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"min_ma"</span></span>
<span><span class="co"># Filter units with older maximum age than bins</span></span>
<span><span class="va">units</span> <span class="op">&lt;-</span> <span class="va">units</span><span class="op">[</span><span class="va">units</span><span class="op">$</span><span class="va">max_ma</span> <span class="op">&lt;</span> <span class="fl">541</span>,<span class="op">]</span></span>
<span><span class="co"># Bin data</span></span>
<span><span class="va">units</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://palaeoverse.palaeoverse.org/reference/bin_time.html" class="external-link">bin_time</a></span><span class="op">(</span>occdf <span class="op">=</span> <span class="va">units</span>, bins <span class="op">=</span> <span class="va">bins</span>,</span>
<span>                  min_ma <span class="op">=</span> <span class="st">"min_ma"</span>, max_ma <span class="op">=</span> <span class="st">"max_ma"</span>,</span>
<span>                  method <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span>
<span><span class="co"># Calculate the number of lithological classes per bin assignment</span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://palaeoverse.palaeoverse.org/reference/group_apply.html" class="external-link">group_apply</a></span><span class="op">(</span>occdf <span class="op">=</span> <span class="va">units</span>,</span>
<span>                      group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lithology_class"</span>,</span>
<span>                                <span class="st">"bin_assignment"</span><span class="op">)</span>,</span>
<span>                      fun <span class="op">=</span> <span class="va">nrow</span><span class="op">)</span></span>
<span><span class="co"># Rename columns to ease reading and merging</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"count"</span>, <span class="st">"lithology_class"</span>, <span class="st">"bin"</span><span class="op">)</span></span>
<span><span class="co"># Merge datasets by bin number</span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bins</span>, y <span class="op">=</span> <span class="va">counts</span>, by <span class="op">=</span> <span class="st">"bin"</span><span class="op">)</span></span>
<span><span class="co"># Generate a plot of lithostratigraphic units through time</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">counts</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">lithology_class</span>, y <span class="op">=</span> <span class="va">count</span>, x <span class="op">=</span> <span class="va">mid_ma</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Stacked bar chart with width specified by interval duration</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"stack"</span>, stat <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>           width <span class="op">=</span> <span class="va">counts</span><span class="op">$</span><span class="va">duration_myr</span>,</span>
<span>           color <span class="op">=</span> <span class="st">"black"</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Label y-axis</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span><span class="st">"Counts of lithostratigraphic units"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Label x-axis and reverse direction</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_reverse</a></span><span class="op">(</span><span class="st">"Time (Ma)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Data plotting colors</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#FF0000"</span>, <span class="st">"#00A08A"</span>, <span class="st">"#F2AD00"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Theming</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>        legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Add geological time scale</span></span>
<span>  <span class="fu"><a href="https://williamgearty.com/deeptime/reference/coord_geo.html" class="external-link">coord_geo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="class_proportions-1.png" alt="plot of chunk class_proportions" width="100%"><p class="caption">
plot of chunk class_proportions
</p>
</div>
<p>Hopefully this vignette has shown you some potential uses for
<code>rmacrostrat</code> functions and helped provide a workflow for
your own analyses. If you have any questions about the package or its
functionality, please feel free to join our <a href="https://groups.google.com/g/palaeoverse" class="external-link">Palaeoverse Google
group</a> and leave a comment; we’ll aim to answer it as soon as
possible!</p>
<p>If you’re interested in learning more about <code>rmacrostrat</code>,
don’t forget to check out our other vignettes! You can see which ones
are available by calling
<code>vignette(package = "rmacrostrat")</code>.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Gearty, W. 2024. deeptime: Plotting Tools for Anyone Working in Deep
Time. R package version 1.1.1, <a href="https://CRAN.R-project.org/package=deeptime" class="external-link uri">https://CRAN.R-project.org/package=deeptime</a>.</p>
<p>Jones, L.A., Gearty, W., Allen, B.J., Eichenseer, K., Dean, C.D.,
Galván S., Kouvari, M., Godoy, P.L., Nicholl, C.S.C., Dillon, E.M.,
Flannery-Sutherland, J.T., Chiarenza, A.A. 2022. palaeoverse: A
community-driven R package to support palaeobiological analysis.
<em>Methods in Ecology and Evolution</em>, 14(9), 2205–2215. doi:
10.1111/2041-210X.14099.</p>
<p>Peters, S.E. and Heim, N.A. 2010. The Geological Completeness of
Paleontological Sampling in North America. <em>Paleobiology</em> 36(10),
pp61–79.</p>
<p>Wickham, H. 2016. ggplot2: Elegant Graphics for Data Analysis.
<em>Springer-Verlag New York</em>.</p>
</div>
</div>
<style type="text/css">
p.caption {
  display: none;
}
</style></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.lewisajones.com" class="external-link">Lewis A. Jones</a>, <a href="https://williamgearty.com" class="external-link">William Gearty</a>, <a href="https://www.researchgate.net/profile/Christopher-Dean-15" class="external-link">Christopher D. Dean</a>, <a href="https://bsse.ethz.ch/cevo/the-group/people/person-detail.html?persid=295484" class="external-link">Bethany Allen</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
